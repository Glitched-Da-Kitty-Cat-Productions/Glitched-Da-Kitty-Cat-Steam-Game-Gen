<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Glitched Da Kitty Cat's Steam Game Gen</title>
      <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet">
      <link rel="stylesheet" href="static/styles.css">
   </head>
   <body>
      <h1>Glitched Da Kitty Cat's Steam Game Gen</h1>
      <div class="container">
         <div class="card">
            <form method="POST" action="/">
               <div class="mb-3 search-bar">
                  <input type="text" class="form-control" id="game_name" name="game_name" placeholder="Search for a game..." required>
                  <button type="submit" class="btn btn-primary">Search</button>
               </div>
            </form>
            {% if error %}
            <div class="alert alert-danger">{{ error }}</div>
            {% endif %}
            {% if success %}
            <div class="alert alert-success">
               {{ success }}
               {% if steam_id %}
               <div class="mt-3">
                  <button class="btn-download" onclick="downloadGame('{{ steam_id }}')">Download</button>
               </div>
               <div id="downloadPopup" class="popup">
                  <button class="close-btn" onclick="toggleDownloadPopup()">Close</button>
                  <p id="downloadMessage"></p>
               </div>
               <script>
                  function downloadGame(steamId) {
                      fetch(`/download/${steamId}`, {
                          method: 'POST',
                      })
                      .then(response => response.json())
                      .then(data => {
                          if (data.success) {
                              document.getElementById('downloadMessage').innerText = data.message;
                          } else {
                              document.getElementById('downloadMessage').innerText = 'Failed to download the game.';
                          }
                          toggleDownloadPopup();
                      })
                      .catch(error => {
                          console.error('Error:', error);
                          document.getElementById('downloadMessage').innerText = 'An error occurred while downloading the game.';
                          toggleDownloadPopup();
                      });
                  }
                  
                  function toggleDownloadPopup() {
                      const popup = document.getElementById('downloadPopup');
                      popup.classList.toggle('active');
                  }
               </script>
               {% endif %}
            </div>
            {% endif %}
         </div>
         <div class="text-center mt-4">
            <a href="https://glitched-da-kitty-cat.is-a.dev/" target="_blank" class="btn btn-secondary">
            Visit Glitched Da Kitty Cat
            </a>
         </div>
         <div class="sidebar">
            <button class="btn btn-secondary" id="how-to-install-btn">How to Install Games</button>
            <button class="btn btn-secondary" onclick="window.location.href='/games-list'">Go To Games List</button>
         </div>
         <div class="cream-card">
            <h2>DLC Downloads with CreamInstaller</h2>
            <p>Use <strong>CreamInstaller.exe</strong> to unlock and manage DLCs for your games. Follow the steps below carefully to avoid issues.</p>
            <a target="_blank" href="https://drive.google.com/uc?export=download&id=1EhSBUZNwsGFSysNbUd_qDkWdLZ8IlNOR" class="btn btn-secondary">Download CreamInstaller</a>
            <button class="btn btn-secondary" id="instructions-btn">Show Instructions</button>
         </div>
         <div class="popup" id="instructions-popup">
            <div class="popup-content">
               <span class="close-btn" id="close-instructions">&times;</span>
               <h2>Instructions</h2>
               <ol>
                  <li>Start the program executable. If it doesn't launch, refer to the installation guide.</li>
                  <li>Choose which programs and/or games the program should scan for DLC. The program automatically gathers all installed games from Steam, Epic, and Ubisoft directories.</li>
                  <li>Wait for the program to download and install SteamCMD (if you chose a Steam game). This process is fast and depends on your internet speed.</li>
                  <li>Wait for the program to gather and cache the chosen games' information & DLCs. This may take some time on the first run, depending on the number of games and DLCs.</li>
                  <li>Carefully select which games' DLCs you wish to unlock. Note that not all DLC unlockers are tested for every game!</li>
                  <li>Choose whether or not to install in Proxy mode. If so, pick the proxy DLL to use. If the default <code>winmm.dll</code> doesn't work, refer to the documentation for alternatives.</li>
                  <li>Click the <strong>Generate and Install</strong> button.</li>
                  <li>Click the <strong>OK</strong> button to close the program.</li>
                  <li>If any DLC unlockers cause problems with your games, go back to step 5, select the games to revert changes, and click the <strong>Uninstall</strong> button.</li>
               </ol>
            </div>
         </div>
         <div class="popup" id="how-to-install-popup">
            <div class="popup-content">
               <span class="close-btn" id="close-popup">&times;</span>
               <h2>How to Install the Games</h2>
               <p>Follow these steps to install the games using SteamTools:</p>
               <ol>
                  <li>Download and install <strong>SteamTools</strong> by clicking the button below.</li>
                  <li>Run the setup you downloaded and launch SteamTools.</li>
                  <li>Go to the game's folder containing the `.lua`, `manifests`, and `.sts` files.</li>
                  <li>Select everything in the folder except the `README.txt` (if present).</li>
                  <li>Drag the selected files onto the floating SteamTools window.</li>
                  <li>Restart your Steam client and download the game.</li>
               </ol>
               <a href="https://www.steamtools.net/res/st-setup-1.8.16.exe" class="btn btn-primary">Download SteamTools</a>
               <h3>Video Tutorial</h3>
               <div class="video-container">
                  <iframe 
                     width="560" 
                     height="315" 
                     src="https://www.youtube.com/embed/3T47Uwx9QlM?start=12" 
                     title="YouTube video tutorial" 
                     frameborder="0" 
                     allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                     allowfullscreen>
                  </iframe>
               </div>
            </div>
         </div>
         {% if game_details %}
         <div class="text-center mt-4">
            <button onclick="togglePopup()" class="btn-secondary" style="margin-top: 1rem;">Show Game Info</button>
         </div>
         <div id="gamePopup" class="popup">
            <button class="close-btn" onclick="togglePopup()">Close</button>
            <h2>{{ game_details.name }}</h2>
            <img src="{{ game_details.header_image }}" alt="{{ game_details.name }}" style="width: 100%; border-radius: 0.5rem;">
            <p><strong>About the Game:</strong> {{ game_details.short_description }}</p>
            <p><strong>Price:</strong> {{ game_details.price_overview.final_formatted if game_details.price_overview else 'Free' }}</p>
            <p><strong>Release Date:</strong> {{ game_details.release_date.date }}</p>
            <p><strong>Developers:</strong> {{ ", ".join(game_details.developers) }}</p>
            <p><strong>Publishers:</strong> {{ ", ".join(game_details.publishers) }}</p>
            <a href="steam://store/{{ game_details.steam_appid }}" class="btn-secondary" style="margin-top: 1rem; display: inline-block;">Open in Steam</a>
            <div class="tabs mt-3">
               <button class="tab-button" onclick="showTab('popupScreenshots')">Screenshots</button>
               <button class="tab-button" onclick="showTab('popupTrailers')">Trailers</button>
            </div>
            <div id="popupScreenshots" class="tab-content">
               {% for screenshot in game_details.screenshots[:3] %}
               <img src="{{ screenshot.path_thumbnail }}" alt="Screenshot" style="margin: 0.5rem; width: 100%; max-width: 300px;">
               {% endfor %}
            </div>
            <div id="popupTrailers" class="tab-content" style="display: none;">
               {% for movie in game_details.movies[:5] %}
               <video controls style="margin: 0.5rem; width: 100%; max-width: 300px;">
                  <source src="{{ movie.mp4.max }}" type="video/mp4">
                  Your browser does not support the video tag.
               </video>
               {% endfor %}
            </div>
         </div>
         <script>
            function togglePopup() {
                const popup = document.getElementById('gamePopup');
                popup.classList.toggle('active');
            }
            
            function showTab(tabId) {
                const tabContent = document.getElementById(tabId);
                if (tabContent.style.display === 'block') {
                    tabContent.style.display = 'none';
                } else {
                    document.querySelectorAll('.tab-content').forEach(content => content.style.display = 'none');
                    tabContent.style.display = 'block';
                }
            }
         </script>
         {% endif %}
      </div>
      <script>
         const popup = document.getElementById("how-to-install-popup");
         const openPopupBtn = document.getElementById("how-to-install-btn");
         const closePopupBtn = document.getElementById("close-popup");
         
         openPopupBtn.addEventListener("click", () => {
             popup.classList.add("active");
         });
         
         closePopupBtn.addEventListener("click", () => {
             popup.classList.remove("active");
         });
         
         window.addEventListener("click", (event) => {
             if (event.target === popup) {
                 popup.classList.remove("active");
             }
         });
             function toggleUsageGuide() {
         const usageInstructions = document.getElementById("usageInstructions");
         if (usageInstructions.style.display === "none") {
             usageInstructions.style.display = "block";
         } else {
             usageInstructions.style.display = "none";
         }
         }
         const instructionsPopup = document.getElementById("instructions-popup");
         const openInstructionsBtn = document.getElementById("instructions-btn");
         const closeInstructionsBtn = document.getElementById("close-instructions");
         
         openInstructionsBtn.addEventListener("click", () => {
         instructionsPopup.classList.add("active");
         });
         
         closeInstructionsBtn.addEventListener("click", () => {
         instructionsPopup.classList.remove("active");
         });
         
         window.addEventListener("click", (event) => {
         if (event.target === instructionsPopup) {
             instructionsPopup.classList.remove("active");
         }
         });
      </script>
   </body>
</html>